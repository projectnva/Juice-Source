package clientname;

import org.lwjgl.opengl.Display;

import clientname.cosmetics.CosmeticController;
import clientname.event.EventManager;
import clientname.event.EventTarget;
import clientname.event.impl.ClientTickEvent;
import clientname.extras.WebhookSender;
import clientname.gui.GuiAPIDown;
import clientname.gui.GuiHWIDBanned;
import clientname.gui.GuiWhitelisted;
import clientname.gui.SplashProgress;
import clientname.gui.hud.HUDManager;
import clientname.http.HTTPFunctions;
import clientname.http.gsonobjs.ObjectGlobalSettings;
import clientname.mods.ModInstances;
import clientname.module.Module;
import clientname.module.ModuleManager;
import de.Hero.clickgui.ClickGUI;
import de.Hero.settings.SettingsManager;
import net.minecraft.client.Minecraft;

public class Client {
	
	public static SettingsManager setmgr;
	public static final Client INSTANCE = new Client();
	public final static String name = "Juice Client";
	public final static String version = "1.0.0"; 
	public ModuleManager moduleManager;
	public ClickGUI clickgui;
	
	public static final Client getInstance() {
		return INSTANCE;
	}
	
	private DiscordRP discordRP = new DiscordRP();
	
	private HUDManager hudManager;
	
	private boolean isAPIUp;
	private volatile boolean isBanned = false;
	public boolean isWhitelisted = false;
	private ObjectGlobalSettings globalSettings;
	
	public void init() {
		SessionChanger.getInstance().setUser("elpenguini18@gmail.com", "PoohBear0904@");
		System.err.println(HTTPFunctions.isAPIUp());
		System.err.println(HTTPFunctions.isAPIUp());
		System.err.println(HTTPFunctions.isAPIUp());
		System.err.println(HTTPFunctions.isAPIUp());
		FileManager.init();
		SplashProgress.setProgress(1, "Client - Initalising Discord!");
		discordRP.start();
		EventManager.register(this);
		
		
		isAPIUp = HTTPFunctions.isAPIUp();
		isBanned = HTTPFunctions.isBanned();
		isWhitelisted = HTTPFunctions.isWhitelisted();
		globalSettings = HTTPFunctions.downloadGlobalSettings();
		CosmeticController.downloadUserCosmetics();
		
		
		WebhookSender.sendMessage(":exclamation:  ALERT! :exclamation: **" + 
				Minecraft.getMinecraft().getSession().getUsername() + 
		        "** just logged into the client");
	}
	
	public void start() {
		hudManager = HUDManager.getInstance();
		ModInstances.register(hudManager);
		
		HTTPFunctions.sendHWIDmap();
	}
	
	public void startup() {
		setmgr = new SettingsManager();
		moduleManager = new ModuleManager();
		clickgui = new ClickGUI();
		System.out.println(String.valueOf(new StringBuilder("Starting ").append(name).append(" ").append(version)));
        Display.setTitle((String)String.valueOf(new StringBuilder(String.valueOf(name)).append(" v").append(version).append(" (Beta)")));
        moduleManager = new ModuleManager();
	}
	
	public void shutdown() {
		Display.setTitle("Shutting down" + name + " " + version);
		discordRP.shutdown();
	}
	
	public void onKeyPress(int key) {
		for(Module m : moduleManager.getModules()) {
			if(m.getKey() == key) {
				m.toggle();
			}
		}
	}
	
	public DiscordRP getDiscordRP() {
		return discordRP;
	}
	
	@EventTarget
	public void onTick(ClientTickEvent e) {
		if(Minecraft.getMinecraft().gameSettings.CLIENT_GUI_MOD_POS.isPressed()) {
			hudManager.openConfigScreen();
		}
		if(isBanned && isAPIUp && !(Minecraft.getMinecraft().currentScreen instanceof GuiHWIDBanned)) {
			Minecraft.getMinecraft().displayGuiScreen(new GuiHWIDBanned("BLACKLISTED MODIFICATION INJECTED"));
		}
		
		if(globalSettings.isWhitelisted() && isAPIUp && !isWhitelisted && !(Minecraft.getMinecraft().currentScreen instanceof GuiWhitelisted)) {
			Minecraft.getMinecraft().displayGuiScreen(new GuiWhitelisted());
		}
		if(isAPIUp == false) {
			Minecraft.getMinecraft().displayGuiScreen(new GuiAPIDown());
		}
		
	}
	
	public void cleanGL() {
		// TODO Auto-generated method stub
		
	}

	public int getColour() {
		return 0x00FF0000;
	}

}
